<?php

    $heartBeatFile = "heartbeat_data.json" ;
    $lastHeartBeat = filemtime($heartBeatFile) ;

    $json = file_get_contents($heartBeatFile);

    // Decode the JSON file
    $json_data = json_decode($json,true);
?>

<!doctype html>
<html>
  <head>
    <title>Status of Irrigation System</title>

    <div>
  <canvas id="myChart"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  const ctx = document.getElementById('myChart');

  new Chart(ctx, {
    type: 'line',
    data: {
      labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],
      datasets: [{
        label: 'Rainfall',
        data: [<?php $json_data["wbz_rainfall"] ?>],
        borderWidth: 1
      }, {
          label: 'Zone One',
          data: [<?php $json_data["wbz_zone1"] ?>],
          borderWidth: 1
      },{
          label: 'Zone Two',
          data: [<?php $json_data["wbz_zone2"] ?>],
          borderWidth: 1
      }]
    },
    options: {
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });
</script>

  </head>
  <body>
    <p><?php echo "Last heartbeat: " . date("Y-m-d H:i:s", $lastHeartBeat)?></p>
    <p><?php echo "IP Address: " . $json_data["iam"] ?></p>
    <p><?php echo "Last Reboot: " . $json_data["last_reboot"] ?></p>
    <p><?php echo "Rainfall: " . $json_data["wbz_rainfall"][10] ?></p>
    <p><?php echo "Zone 1: " . $json_data["wbz_zone1"] ?></p>
    <p><?php echo "Zone 2: " . $json_data["wbz_zone2"] ?></p>
</body>
</html>
